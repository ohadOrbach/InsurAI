---
description: 
globs: 
alwaysApply: true
---
# Memory Bank Management System

## CORE MEMORY BANK FUNCTIONS

You MUST implement and maintain a persistent memory bank that tracks workflow progress across sessions. The memory bank is the foundation for RIPER workflow continuity.

## MEMORY BANK INITIALIZATION

### Auto-Create Memory Bank Structure
When memory bank doesn't exist, create:
```bash
mkdir -p memory-bank/workflow
mkdir -p memory-bank/research  
mkdir -p memory-bank/innovate
mkdir -p memory-bank/plan
mkdir -p memory-bank/execute
mkdir -p memory-bank/review
```

### Initialize Core Memory Files
Create these files if they don't exist:

**memory-bank/workflow/riper-state.json**
```json
{
  "currentStage": "RESEARCH",
  "workflowId": "workflow_<timestamp>",
  "startedAt": "<ISO_timestamp>",
  "lastUpdate": "<ISO_timestamp>",
  "sessionCount": 1,
  "stageHistory": []
}
```

**memory-bank/workflow/stage-completions.json**
```json
{
  "completions": [],
  "currentCycle": 1,
  "totalCycles": 0
}
```

**memory-bank/workflow/knowledge-base.json**
```json
{
  "projectKnowledge": {},
  "technicalFindings": {},
  "decisions": {},
  "learnings": {},
  "crossReferences": {}
}
```

**memory-bank/workflow/decisions.json**
```json
{
  "decisions": [],
  "decisionHistory": [],
  "pendingDecisions": []
}
```

## MEMORY BANK OPERATIONS

### Load Memory Bank
```typescript
interface MemoryBank {
  riperState: RIPERState;
  stageCompletions: StageCompletions;
  knowledgeBase: KnowledgeBase;
  decisions: DecisionLog;
  stageMemories: {
    research?: ResearchMemory;
    innovate?: InnovateMemory;
    plan?: PlanMemory;
    execute?: ExecuteMemory;
    review?: ReviewMemory;
  };
}
```

### Save Memory Bank
- Auto-save after significant actions
- Version control with timestamps
- Backup before major operations
- Integrity checks on save

### Memory Bank Recovery
- Detect corrupted memory files
- Recover from backups
- Rebuild missing components
- Validate memory consistency

## STAGE-SPECIFIC MEMORY TEMPLATES

### Research Memory Template
**memory-bank/research/findings.md**
```markdown
# Research Findings - Cycle <N>

## Key Discoveries
- Discovery 1: Description
- Discovery 2: Description

## Sources Investigated
- Source 1: URL/Reference
- Source 2: URL/Reference

## Questions Raised
- Question 1: Description
- Question 2: Description

## Insights for Innovation
- Insight 1: Description
- Insight 2: Description
```

### Innovation Memory Template  
**memory-bank/innovate/ideas.md**
```markdown
# Innovation Ideas - Cycle <N>

## Generated Ideas
### Idea 1: <Title>
- Description: <details>
- Feasibility: <assessment>
- Impact: <assessment>

## Selected Ideas
- Idea A: <rationale>
- Idea B: <rationale>

## Evaluation Criteria
- Criterion 1: <weight>
- Criterion 2: <weight>
```

### Planning Memory Template
**memory-bank/plan/specifications.md**
```markdown
# Implementation Specifications - Cycle <N>

## Technical Specifications
- Spec 1: <details>
- Spec 2: <details>

## Dependencies
- Dependency 1: <description>
- Dependency 2: <description>

## Implementation Steps
1. Step 1: <details>
2. Step 2: <details>

## Risk Assessment
- Risk 1: <impact> / <probability>
- Risk 2: <impact> / <probability>
```

### Execution Memory Template
**memory-bank/execute/implementation-log.md**
```markdown
# Implementation Log - Cycle <N>

## Progress Tracking
- [ ] Task 1: <status>
- [ ] Task 2: <status>

## Code Changes
- File 1: <changes>
- File 2: <changes>

## Issues Encountered
- Issue 1: <description> / <resolution>
- Issue 2: <description> / <resolution>

## Next Steps
- Next 1: <description>
- Next 2: <description>
```

### Review Memory Template
**memory-bank/review/assessment.md**
```markdown
# Review Assessment - Cycle <N>

## Implementation Review
- Success Metrics: <achieved/target>
- Quality Assessment: <rating>
- Performance Analysis: <results>

## Lessons Learned
- Lesson 1: <description>
- Lesson 2: <description>

## Improvements Identified
- Improvement 1: <description>
- Improvement 2: <description>

## Next Cycle Planning
- Focus Areas: <list>
- Carry Forward: <items>
```

## MEMORY BANK COMMANDS

### Memory Status Commands
- `/memory-status` → Display current memory bank state
- `/memory-health` → Check memory bank integrity
- `/memory-summary` → Generate memory bank summary

### Memory Management Commands  
- `/memory-backup` → Create memory bank backup
- `/memory-restore` → Restore from backup
- `/memory-clean` → Clean up old/unused memory
- `/memory-export` → Export memory to external format

### Memory Navigation Commands
- `/memory-research` → Show research memory
- `/memory-innovate` → Show innovation memory
- `/memory-plan` → Show planning memory
- `/memory-execute` → Show execution memory
- `/memory-review` → Show review memory

## MEMORY BANK INTEGRATION

### With RIPER Workflow
- Stage transitions update memory bank
- Memory provides context for each stage
- Knowledge accumulates across cycles
- Decisions reference previous memory

### With State Management
- Memory bank state syncs with .cursor/state.md
- Stage completions update both systems
- Workflow continuity maintained

### With User Experience
- Memory provides context awareness
- Previous work influences recommendations
- Learning improves over time
- Progress tracking across sessions

## ERROR HANDLING

### Memory Corruption
- Detect inconsistencies
- Attempt automatic repair
- Fall back to backups
- Notify user of issues

### Missing Memory
- Create missing components
- Initialize with templates
- Maintain referential integrity
- Log recovery actions

### Version Conflicts
- Detect version mismatches
- Migrate to current format
- Preserve historical data
- Update version markers
